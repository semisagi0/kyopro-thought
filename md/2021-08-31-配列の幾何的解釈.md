## 配列の幾何的解釈
### 概要
配列の幾何的解釈を説明する。

### 基本
配列の第`i`要素`A[i]`を左端が`i`、右端が`i+1`の正方形として捉える。

- 0-origin（=配列の最初の要素が`A[0]`）
```
           +---+---+---+---+---+
           | 0 | 1 | 2 | 3 | 4 |
---+---+---*---+---+---+---+---+---+---> x
  -1  -2   0   1   2   3   4   5   6
```

- 1-origin（=配列の最初の要素が`A[1]`）
```
               +---+---+---+---+---+
               | 1 | 2 | 3 | 4 | 5 |
---+---+---*---+---+---+---+---+---+---> x
  -1  -2   0   1   2   3   4   5   6
```

実装では0-originとなることが多いが、考察の過程では1-originのまま進めることもある。また考察では配列を使用するが実装では配列を使用しない場合もある。
たとえば`A[1]`と`A[100000]`に挟まれる要素の個数を求めるのに`A`の具体的な値を知る必要はなく、`100000-(1+1)`によって計算できる。
0-originと1-originの頭の切り替えで混乱しないようにするため、できる限り添字の始まりに依存しない性質を使用する。

### 要素の左端と右端
`A[i]`の左端と右端は添字の始まりによらず`i`と`i+1`である。

### 配列の左端
配列の左端とは、配列の最初の要素の左端のことである。配列の左端は0-originなら`0`、1-originなら`1`である。

### 配列の右端
配列の右端とは、配列の最後の要素の右端のことである。配列の右端は配列の左端に要素数を足した位置にある。配列の右端は0-originなら`N`、1-originなら`N+1`である。

### 配列の要素数
配列の右端と配列の左端の差が要素数になる。

### 半開区間
半開区間`A[i,j)`は`[A[i],A[i+1],...,A[j-1]]`を表す。半開区間の`i`,`j`は要素の境界の座標を表していると考えられる。

```
i=1, j=4

               i           j
           +---+---+---+---+---+
           | 0 | 1 | 2 | 3 | 4 |
---+---+---*---+---+---+---+---+---+---> x
  -1  -2   0   1   2   3   4   5   6
               [<--------->]
```

### 半開区間に含まれる要素の個数
半開区間`[i,j)`に含まれる要素の個数は`j-i`個である。`i`と`j`を境界の座標と捉えれば、その差がそのまま要素数となる。
```
               i           j
           +---+---+---+---+---+
           | 0 | 1 | 2 | 3 | 4 |
---+---+---*---+---+---+---+---+---+---> x
  -1  -2   0   1   2   3   4   5   6
               [<--------->]
```

### `A[i]`より前にある要素の個数
`A[i]`を含まない場合、`(A[i]の左端) - (配列の左端) = i - (配列の左端)`が要素数になる。
`A[i]`を含む場合、`(A[i]の右端) - (配列の左端) = (i+1) - (配列の左端)`が要素数になる。

### `A[i]`より後ろにある要素の個数
`A[i]`を含まない場合、`(配列の右端) - (A[i]の右端) = (配列の右端) - (i+1)`が要素数になる。
`A[i]`を含む場合、`(配列の右端) - (A[i]の左端) = (配列の右端) - i`が要素数になる。

### `A[i]`と`A[j]`に挟まれる要素の個数
たとえば`A[1]`と`A[4]`に挟まれる要素は`A[2],A[3]`の2つである。これは次のように図で計算できる。

```
i=1, j=4

                 i           j
           +---+---+---+---+---+
           | 0 | 1 | 2 | 3 | 4 |
---+---+---*---+---+---+---+---+---+---> x
  -1  -2   0   1   2   3   4   5   6
                   |<----->|
```

つまり`(A[j]の左端)-(A[i]の右端)=j-(i+1)`によって計算できる。

### 奇数番目の要素
配列が1-originであれば`A[1],A[3],A[5],...`が奇数番目の要素である。0-originでは`A[0],A[2],A[4],...`となる。これを添字の始まりに依存しないように考え直したい。

そこで`A[i]`が先頭から数えて奇数個目の要素であるならば奇数番目の要素であると考え直す。つまり`A[i]`含めてそれより前の要素の個数が奇数個であれば奇数番目と捉える。このようにした場合、0-originならば`((i+1)-0)%2==1`、1-originならば`((i+1)-1)%2==1`となる。

`i`番目という座標の情報ではなく、`i`個目という個数の情報で捉えることでoriginの任意性の問題を回避できることは多い。

### 先頭から`i`個目の要素
`(配列の左端) + i`がその要素の右端になるはずなので、添字=その要素の左端は`(配列の左端) + i - 1`によって計算できる。1-originの場合は先頭から`i`個目の要素と`i`番目の要素は一致する。

### 末尾から`i`個目の要素
`(配列の右端) - i`がその要素の左端になるはずなので、添字=その要素の左端は`(配列の右端) - i`によって計算できる。

### 累積和
`A[0],...,A[N]`の累積和`S[n]`を`S[n]=A[0]+...+A[n-1]`として定義する。ただし`S[0]=0`である。

`S[k]`の`k`は境界の座標を表している。そのため`x=0`と`x=k`に囲まれる要素の総和が`S[k]`である。

```
           +---+---+---+---+---+
           | 0 | 1 | 2 | 3 | 4 |
---+---+---*---+---+---+---+---+---+---> x
  -1  -2   0   1   2   3   4   5   6
    S[0] = |
    S[1] = |<->|
    S[2] = |<----->|
    S[3] = |<--------->|
    S[4] = |<------------->|
    S[5] = |<----------------->|
```

`A[i]+...+A[j]`は幾何的には左端が`x=i`、右端が`x=j+1`だから`S[j+1]-S[i]`によって計算できる。

### 末尾からの累積和
接頭辞ではなく接尾辞に対する累積和も考えられる。これは次のように定義する。

```
           +---+---+---+---+---+
           | 0 | 1 | 2 | 3 | 4 |
---+---+---*---+---+---+---+---+---+---> x
  -1  -2   0   1   2   3   4   5   6
    T[5] =                     |
    T[4] =                 |<->|
    T[3] =             |<----->|
    T[2] =         |<--------->|
    T[1] =     |<------------->|
    T[0] = |<----------------->|
```

`A[i]+...+A[j]`は幾何的には左端が`x=i`、右端が`x=j+1`だから`T[i]-T[j+1]`によって計算できる。

### 中央値
配列の左端と右端の中点に位置する要素である。

0-originで`N=5`の場合、`(0+5)/2=2.5`なので`A[2]`が中央値になる。
```
           |---------v---------|
           +---+---+---+---+---+
           | 0 | 1 | 2 | 3 | 4 |
---+---+---*---+---+---+---+---+---+---> x
  -1  -2   0   1   2   3   4   5   6
```

0-originで`N=6`の場合、`(0+6)/2=3`なので`A[2],A[3]`が中央値になる。
```
           |-----------v-----------|
           +---+---+---+---+---+---+
           | 0 | 1 | 2 | 3 | 4 | 5 |
---+---+---*---+---+---+---+---+---+---> x
  -1  -2   0   1   2   3   4   5   6
```

1-originで`N=5`の場合、`(1+6)/2=3.5`なので`A[3]`が中央値になる。
```
               |---------v---------|
               +---+---+---+---+---+
               | 1 | 2 | 3 | 4 | 5 |
---+---+---*---+---+---+---+---+---+---> x
  -1  -2   0   1   2   3   4   5   6
```

1-originで`N=6`の場合、`(1+7)/2=4`なので`A[3],A[4]`が中央値になる。
```
               |-----------v-----------|
               +---+---+---+---+---+---+
               | 1 | 2 | 3 | 4 | 5 | 6 |
---+---+---*---+---+---+---+---+---+---+---> x
  -1  -2   0   1   2   3   4   5   6   7
```
